{% extends "layout_navi.html"%}

{% block extra_script %}
<script>
$(function() {
    $('#edit_button').click(function() {
        var timestamp = parseInt($(this).data("possible-timestamp"));
        if ( timestamp < (new Date()).getTime() ) {
          alert("???");
          return false;
        }
        return true;
    });
});
</script>
{% endblock %}

{% block content %}
<main>
  <div class="container">
    <p class="today__question">Today's Question<br>
    <span lang="ko">{{ question }}</span></p>


{% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div {% if message.tags %} class="alert alert-{{ message.tags }}"{% endif %}>
                {{ message.message }}
            </div>
        {% endfor %}
    </div>
{% endif %}


<div class="row">
{% for answer in answer_list %}
{% if forloop.first %}
<div id="accordion" role="tablist" aria-multiselectable="true" class="col-12">
    <div class="card">
      <div class="card-header" role="tab" id="{{answer.id}}id">
        <h5 class="mb-0">
          <a data-toggle="collapse" data-parent="#accordion" href="#kk{{answer.id}}" aria-expanded="true" aria-controls="kk{{answer.id}}">
            Year {{ answer.created_at |date:"Y" }}
          </a>
        </h5>
      </div>

      <div id="kk{{answer.id}}" class="collapse show" role="tabpanel" aria-labelledby="{{answer.id}}id">
        <div class="card-block" lang="ko">
          {{ answer.content }}
        </div>
        <div class="main__card__button">
          <a id="edit_button" class="mx-3" lang="ko" href="{% url "qna:question_edit" answer.id %}" data-possible-timestamp="131231312412">수정</a>
        </div>
      </div>
    </div>
{% else %}
    <div class="card">
      <div class="card-header" role="tab" id="{{answer.id}}id">
        <h5 class="mb-0">
          <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#kk{{answer.id}}" aria-expanded="false" aria-controls="kk{{answer.id}}">
            Year {{ answer.created_at |date:"Y" }}
          </a>
        </h5>
      </div>

      <div id="kk{{answer.id}}" class="collapse" role="tabpanel" aria-labelledby="{{answer.id}}id">
        <div class="card-block" lang="ko">
          {{ answer.content }}
        </div>
        <div class="main__card__button">
          <a class="mx-3" lang="ko" href="{% url "qna:question_edit" answer.id %}">수정</a>
        </div>
      </div>
    </div>
{% endif %}
{% endfor %}


{%if ex_answer %}
    <div class="card">
      <div class="card-header" role="tab" id="{{ex_answer.id}}dk">
        <h5 class="mb-0">
          <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#kk{{ ex_answer.id }}" aria-expanded="false" aria-controls="kk{{ ex_answer.id }}" lang="ko">
            추가질문: {{ exquestion }}
          </a>
        </h5>
      </div>

      <div id="kk{{ ex_answer.id }}" class="collapse" role="tabpanel" aria-labelledby="{{ex_answer.id}}dk">
        <div class="card-block" lang="ko">
          {{ ex_answer.content }}
        </div>
        <div class="main__card__button">
          <a class="mx-3" lang="ko" href="{% url "exqna:exquestion_edit" ex_answer.id %}">수정</a>
        </div>
      </div>
    </div>
{%endif%}
    </div>
</div>




{% if form %}
          <form action="" method="POST">
              {% csrf_token %}
             {% for error in form.non_field_errors %}
            {{ error }}
        {% endfor %}

        <!-- hidden fields는 위젯만 렌더링 -->
        {% for field in form.hidden_fields %}
          {{ field }}
        {% endfor %}

    <div class="row">
      <div class="form-group answer__form main__part col-12 col-sm-8 col-lg-6 push-sm-4 push-lg-6">
                <label class="question" for="exampleTextarea" lang="ko">
                      <span lang="ko" class="extra-question">오늘의 추가 질문 :</span> <br> {{ exquestion }}
                </label>
            <textarea class="form-control" id="exampleTextarea" rows="1" name="content">{{ form.content | striptags }}</textarea>
            </div>
        </div>

        <div class="row">
            <div class="submit__answer col-12 col-sm-8 col-lg-6 push-sm-4 push-lg-6">
                <label class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" name="is_public"
                    {% if form.is_public|make_list|length >= 78 %}
                    checked="checked"
                    {% endif %}
                    />
                    <span class="custom-control-indicator"></span>
                    <span class="custom-control-description">공유하기</span>
                </label>
                <input type="submit" value="제출하기" name="ex_answer" class="btn btn-success bg-success" />
            </div>
        </div>
</form>
 {% endif %}


</div>
</main>{%endblock%}







<!DOCTYPE html>
<html lang="ko">
<head>

</head>
<body>
    <h1>메인화면입니다</h1>
    <h2>Today's Question  {{ question }}</h2>

    {% for answer in answer_list %}
        <p>
            Year {{ answer.created_at |date:"Y" }} <br>
            {{ answer.content }} <br>
<div>
{% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div {% if message.tags %} class="alert alert-{{ message.tags }}"{% endif %}>
                {{ message.message }}
            </div>
        {% endfor %}
    </div>
{% endif %}
</div>
    <br><br>
            <a href="{% url "qna:question_edit" answer.id %}"><input type="button" value="수정"></a>
        </p>
    {% endfor %}



    {% if ex_answer %}
        <strong>오늘의 추가질문</strong> {{ exquestion }}   <br>
        {{ ex_answer.content }} <br>


        <a href="{% url "exqna:exquestion_edit" ex_answer.id %}"><input type="button" value="수정"></a>
    {%endif%}
    <!--추가질문은 답을 안하고 그냥 넘기면 ex_answer.id가 없기 때문에 에러가 났었다-->
    <!--이 부분을 ex_answer가 있을 때만 추가질문 수정이 적용되게 하여 해결-->

    {% if form %}
        <form action="" method="post">
        {% csrf_token %}
        <table>
            {{ form.as_table }}
        </table>
        <input type="submit" name="">
        </form>
    {% endif %}

    <hr/>
    <a href="{%url "qna:question_search"%}"><input type="button" value="질문으로 검색해보기"></a>
    <br>

    <br>
    <a href="{%url "diary:diary_list" %}"><input type="button" value="다이어리보기"></a>
    <br>
    <a href="{%url "exqna:required" %}"><input type="button" value="질문 추가해보기"></a>
    <br>
    <a href="{%url "qna:other_people" %}"><input type="button" value="질문에 대한 다른 사람의 답변"></a>
    <hr>
    <br>
    <a href="{% url "logout"%}?next={{request.path}}"><input type="button" value="로그아웃"></a>
    <br>
    <br>
    <a href="{%url "profile" %}"><input type="button" value="내 프로필 보기"></a>
</body>
</html>
<!--메인 화면에 다이어리,질문 추가, 다른 사람의 답변 열람까지 연결 완료, 메인 화면에 질문 보는거 연결하고 그 안에 추가질문 보는거 연결함-->
